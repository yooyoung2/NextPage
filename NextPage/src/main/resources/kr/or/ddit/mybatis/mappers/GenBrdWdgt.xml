<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.generation.options.board.widget.dao.BoardWidgetDAO">

<!-- 2개짜리 목록형 게시판 위젯 -->
<select id="selectLtBrdWgt" parameterType="string" resultType="GenBrdWdgtVO" >
WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 3
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 5
  ]]>
</select>
<select id="selectRtBrdWgt" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 2
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 5
  ]]>
</select>

<!-- 1개짜리 목록형 게시판 위젯 -->
<select id="selectOnebrd" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 1
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 5
  ]]>
</select>


<!-- 1개짜리 이미지 게시판 위젯 -->
<select id="selectOneImg" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 4
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 3
  ]]>
</select>

<!-- 2개짜리 이미지 게시판 위젯 -->
<select id="selectLtImgWgt" parameterType="string" resultType="GenBrdWdgtVO" >
WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 5
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 4
  ]]>
</select>
<select id="selectRtImgWgt" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 6
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 4
  ]]>
</select>

<!-- 2개짜리 동영상 게시판 위젯 -->
<select id="selectLtVdWgt" parameterType="string" resultType="GenBrdWdgtVO" >
WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 7
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 3
  ]]>
</select>
<select id="selectRtVdWgt" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 8
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 3
  ]]>
</select>

<!-- 3개짜리 동영상 게시판 위젯 -->
<select id="triLtVdWgt" parameterType="string" resultType="GenBrdWdgtVO" >
WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 9
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 3
  ]]>
</select>
<select id="triMdVdWgt" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 10
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 3
  ]]>
</select>

<select id="triRtVdWgt" parameterType="string" resultType="GenBrdWdgtVO">

WITH AAA AS(
SELECT
	BW.BRD_NUM ,
	GP.POST_TITLE,
	GB.BRD_TITLE,
	GP.POST_NUM,
	GB.SCH_ID,
	(SELECT MIN(SAVE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_NAME,
    (SELECT MIN(FILE_NAME) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) FILE_NAME,
    (SELECT MIN(SAVE_PATH) FROM POST_ATCH WHERE POST_NUM=GP.POST_NUM) SAVE_PATH,
	TO_CHAR(GP.POST_WRITE_DATE, 'YYYY-MM-DD') POST_WRITE_DATE
FROM BOARD_WIDGET BW, GEN_POST GP, GEN_BOARD GB
WHERE WIDGET_ORD = 11
AND GB.SCH_ID=#{schId, jdbcType=VARCHAR}
AND BW.BRD_NUM = GP.BRD_NUM
AND GB.BRD_NUM = GP.BRD_NUM
ORDER BY GP.POST_WRITE_DATE DESC
) SELECT ROWNUM, AAA.*
  FROM AAA
  <![CDATA[
  WHERE ROWNUM < 3
  ]]>
</select>


<!-- 알림판  -->
<select id="noticeBrd" parameterType="string" resultType="GenBrdWdgtVO">
SELECT SCH_ID, ORD_NUM, FILE_NAME,
       URL_INFO, SAVE_NAME, SAVE_PATH
FROM GEN_ALERT_BRD
WHERE SCH_ID=#{schId, jdbcType=VARCHAR}
AND URL_INFO IS NOT NULL
ORDER BY ORD_NUM

</select>


<!-- 식단 -->
<select id="dietBrd" parameterType="string" resultType="GenBrdWdgtVO">
SELECT
    DIET_DATE,
    LUNCH,
    DINNER
FROM DIET
WHERE SCH_ID=#{schId, jdbcType=VARCHAR}
AND TO_CHAR( DIET_DATE, 'yyyymmdd' ) = TO_CHAR( SYSDATE, 'yyyymmdd')

</select>

<!-- 배너	 -->
<select id="underBanner" parameterType="string" resultType="GenBrdWdgtVO">
SELECT GB.*, BLI.*
FROM GEN_BNR GB, BNR_LK_INFO BLI
WHERE SCH_ID =#{schId, jdbcType=VARCHAR}
AND GB.BNR_LK_ID = BLI.BNR_LK_ID
ORDER BY BNNR_ORD

</select>

<!-- 링크리스트	 -->
<select id="selectLinkList" parameterType="string" resultType="GenLkLstVO">
SELECT
    B.SCH_ID,
    B.ICON_NM,
    B.WIDGET_ORD,
    B.LINK_URL,
    B.LINK_TITLE,
    A.ICON_NM,
    A.ICON_FILE_NAME
FROM
    GEN_LK_LST B,
    LK_LST_ICON A
WHERE
    B.SCH_ID = #{schId, jdbcType=VARCHAR}
AND
    A.ICON_NM = B.ICON_NM
ORDER BY B.WIDGET_ORD


</select>

<!-- 캘린더	 -->
<select id="selectCalendar" parameterType="string" resultType="GenBrdWdgtVO">
SELECT SCH_ID, CALD_START_DATE, CALD_END_DATE,
        SCHEDULE
FROM GEN_CALD
WHERE CALD_END_DATE > SYSDATE-60
AND SCH_ID = #{schId, jdbcType=VARCHAR}
ORDER BY CALD_END_DATE, CALD_START_DATE


</select>



</mapper>